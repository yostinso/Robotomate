<%= javascript_include_tag "remote_event_proxy" %>
<script type="text/javascript">
  jQuery(document).ready(function() {
      var addDevice = function(e, d) {
          var device = new Device(d);
          RemoteEventManager.subscribe(Device, 'state_changed', d.id, device.update);
      };
      var removeDevice = function(e, d) {
          var device = new Device(d);
          RemoteEventManager.subscribe(Device, 'state_changed', d.id, device.update);
      };


      <%= start_remote_event_manager() %>

      RemoteEventManager.subscribe(Device, 'add', null, addDevice);
      RemoteEventManager.subscribe(Device, 'remove', null, removeDevice);
      // RemoteEventManager.subscribe(Device, 'state_changed', 1, addDevice);

      $('.stop_refresh').click(function() {
          if ($(this).html() == "Stop Updating") {
              RemoteEventManager.stop();
              $(this).html("Start Updating");
          } else {
              RemoteEventManager.start();
              $(this).html("Stop Updating");
          }
      });
  });
</script>
<div id="devices">nothing?</div>

<%= link_to "Debug", :controller => :event, :action => :debug, :uuid => @this_page_uuid %><br />
<a class="stop_refresh" href="#">Stop Updating</a>
